# samconfig.toml.in, ABr
# build defaults for AWS serverless integration; must be
# hydrated by scripts/setup-dev-env.sh

version = 0.1

##############################################################
## PROD target
[prod.build.parameters]
template_file = ".local/infra/aws/serverless.template"
build_dir = ".aws-sam/build"
cached = true
parallel = true

[prod.deploy.parameters]
template_file = ".aws-sam/build/template.yaml"
stack_name = "cf-prod"
resolve_s3 = true
capabilities = "CAPABILITY_IAM"
confirm_changeset = true
disable_rollback = false
parameter_overrides = "OwnerEmail=dbmail1771+prod@gmail.com"
tags = "Project=ChartFinder Environment=prod OwnerEmail=dbmail1771+prod@gmail.com ReleaseVersion=${DOLLAR}CF_BACKEND_VERSION_SHORT BuildNumber=${DOLLAR}CF_BACKEND_BUILD_NUMBER"
region = "us-east-2"
profile = "prod-profile"

##############################################################
## STAGE target
[stage.build.parameters]
template_file = ".local/infra/aws/serverless.template"
build_dir = ".aws-sam/build"
cached = true
parallel = true

[stage.deploy.parameters]
template_file = ".aws-sam/build/template.yaml"
stack_name = "cf-stage"
resolve_s3 = true
capabilities = "CAPABILITY_IAM"
confirm_changeset = true
disable_rollback = false
parameter_overrides = "OwnerEmail=dbmail1771+stage@gmail.com"
tags = "Project=ChartFinder Environment=stage OwnerEmail=dbmail1771+stage@gmail.com ReleaseVersion=${DOLLAR}CF_BACKEND_VERSION_SHORT BuildNumber=${DOLLAR}CF_BACKEND_BUILD_NUMBER"
region = "us-east-2"
profile = "stage-profile"

##############################################################
## TEST target
[test.build.parameters]
template_file = ".local/infra/aws/serverless.template"
build_dir = ".aws-sam/build"
cached = true
parallel = true

[test.deploy.parameters]
template_file = ".aws-sam/build/template.yaml"
stack_name = "cf-test"
resolve_s3 = true
capabilities = "CAPABILITY_IAM"
confirm_changeset = true
disable_rollback = false
parameter_overrides = "OwnerEmail=dbmail1771+test@gmail.com"
tags = "Project=ChartFinder Environment=test OwnerEmail=dbmail1771+test@gmail.com ReleaseVersion=${DOLLAR}CF_BACKEND_VERSION_SHORT BuildNumber=${DOLLAR}CF_BACKEND_BUILD_NUMBER"
region = "us-east-2"
profile = "test-profile"

##############################################################
## DEV target
[dev.build.parameters]
template_file = ".local/infra/aws/serverless.template"
build_dir = ".aws-sam/build"
cached = true
parallel = true

[dev.deploy.parameters]
# ABr: initially we must use template_file_pre for initial bootstrap 'sam deploy --guided'
# ABr: this will be modified to template_file_post after successful bootstrap
#template_file_pre = ".local/infra/aws/serverless.template"
#template_file_post = ".aws-sam/build/template.yaml"
template_file = ".local/infra/aws/serverless.template"
stack_name = "$CF_LOCAL_ENV_ID"
resolve_s3 = true
capabilities = "CAPABILITY_IAM"
confirm_changeset = true
disable_rollback = false
parameter_overrides = "OwnerEmail=$CF_LOCAL_USEREMAIL"
tags = "Project=ChartFinder Environment=dev OwnerEmail=$CF_LOCAL_USEREMAIL ReleaseVersion=${DOLLAR}CF_BACKEND_VERSION_SHORT BuildNumber=${DOLLAR}CF_BACKEND_BUILD_NUMBER"
region = "$CF_LOCAL_AWS_REGION"
profile = "$CF_LOCAL_AWS_PROFILE"
s3_prefix = "$CF_LOCAL_ENV_ID"
